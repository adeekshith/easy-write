/**
 * Created by Deekshith Allamaneni on 3/31/16.
 */
"use strict";
// RegEx Used: /\b(?!(word1|word2)\b)\w+/gi
let oneKPlus = /\b(?!(you|I|to|the|a|and|that|it|of|me|what|is|in|this|know|I\'m|for|no|have|my|don\'t|just|not|do|be|on|your|was|we|it\'s|with|so|but|all|well|are|he|oh|about|right|you\'re|get|here|out|going|like|yeah|if|her|she|can|up|want|think|that\'s|now|go|him|at|how|got|there|one|did|why|see|come|good|they|really|as|would|look|when|time|will|okay|back|can\'t|mean|tell|I\'ll|from|hey|were|he\'s|could|didn\'t|yes|his|been|or|something|who|because|some|had|then|say|ok|take|an|way|us|little|make|need|gonna|never|we\'re|too|love|she\'s|I\'ve|sure|them|more|over|our|sorry|where|what\'s|let|thing|am|maybe|down|man|has|uh|very|by|there\'s|should|anything|said|much|any|life|even|off|please|doing|thank|give|only|thought|help|two|talk|people|god|still|wait|into|find|nothing|again|things|let\'s|doesn\'t|call|told|great|before|better|ever|night|than|away|first|believe|other|feel|everything|work|you\'ve|fine|home|after|last|these|day|keep|does|put|around|stop|they\'re|I\'d|guy|long|isn\'t|always|listen|wanted|Mr.|guys|huh|those|big|lot|happened|thanks|won\'t|trying|kind|wrong|through|talking|made|new|being|guess|hi|care|bad|mom|remember|getting|we\'ll|together|dad|leave|mother|place|understand|wouldn\'t|actually|hear|baby|nice|father|else|stay|done|wasn\'t|their|course|might|mind|every|enough|try|hell|came|someone|you\'ll|own|family|whole|another|house|Jack|yourself|idea|ask|best|must|coming|old|looking|woman|hello|which|years|room|money|left|knew|tonight|real|son|hope|name|same|went|um|hmm|happy|pretty|saw|girl|sir|show|friend|already|saying|may|next|three|job|problem|minute|found|world|thinking|haven\'t|heard|honey|matter|myself|couldn\'t|exactly|having|ah|probably|happen|we\'ve|hurt|boy|both|while|dead|gotta|alone|since|excuse|start|kill|hard|you\'d|today|car|ready|until|without|whatever|wants|hold|wanna|yet|seen|deal|took|once|gone|called|morning|supposed|friends|head|stuff|most|used|worry|second|part|live|truth|school|face|forget|true|business|each|cause|soon|knows|few|telling|wife|who\'s|use|chance|run|move|anyone|person|bye|J.|somebody|Dr.|heart|such|miss|married|point|later|making|meet|anyway|many|phone|reason|damn|lost|looks|bring|case|turn|wish|tomorrow|kids|trust|check|change|end|late|anymore|five|least|town|aren\'t|ha|working|year|makes|taking|means|brother|play|hate|ago|says|beautiful|gave|fact|crazy|party|sit|open|afraid|between|important|rest|fun|kid|word|watch|glad|everyone|days|sister|minutes|everybody|bit|couple|whoa|either|Mrs.|feeling|daughter|wow|gets|asked|under|break|promise|door|set|close|hand|easy|question|doctor|tried|far|walk|needs|trouble|mine|though|times|different|killed|hospital|anybody|Sam|alright|wedding|shut|able|die|perfect|police|stand|comes|hit|story|ya|mm|waiting|dinner|against|funny|husband|almost|stupid|pay|answer|four|office|cool|eyes|news|child|shouldn\'t|half|side|yours|moment|sleep|read|where\'s|started|young|men|sounds|sonny|lucky|pick|sometimes|\'em|bed|also|date|line|plan|hours|lose|fire|free|hands|serious|Leo|shit|behind|inside|high|ahead|week|wonderful|T.|fight|past|cut|quite|number|he\'ll|sick|S.|it\'ll|game|eat|nobody|goes|death|along|save|seems|finally|lives|worried|upset|Theresa|Carly|Ethan|met|book|brought|seem|sort|safe|living|children|weren\'t|leaving|front|shot|loved|asking|running|clear|figure|hot|felt|six|parents|drink|absolutely|how\'s|daddy|sweet|alive|Paul|sense|meant|happens|David|special|bet|blood|ain\'t|kidding|lie|full|meeting|dear|coffee|seeing|sound|fault|water|fuck|ten|women|John|welcome|buy|months|hour|speak|lady|Jen|thinks|Christmas|body|order|outside|hang|possible|worse|company|mistake|ooh|handle|spend|C.|totally|giving|control|here\'s|marriage|realize|D.|power|president|unless|sex|girls|send|needed|O.|taken|died|scared|picture|talked|Jake|Al|ass|hundred|changed|completely|explain|playing|certainly|sign|boys|relationship|Michael|loves|fucking|hair|lying|choice|anywhere|secret|future|weird|luck|she\'ll|Max|Luis|turned|known|touch|kiss|Crane|questions|obviously|wonder|pain|calling|somewhere|throw|straight|Grace|cold|white|fast|Natalie|words|R.|food|none|drive|feelings|they\'ll|worked|marry|light|test|drop|cannot|Frank|sent|city|dream|protect|twenty|class|Lucy|surprise|its|sweetheart|forever|poor|looked|mad|except|gun|y\'know|dance|takes|appreciate|especially|situation|besides|weeks|pull|himself|hasn\'t|act|worth|Sheridan|amazing|top|given|expect|Ben|rather|Julian|involved|swear|piece|busy|law|decided|black|Joey|happening|movie|we\'d|catch|Antonio|country|less|perhaps|step|fall|watching|kept|darling|dog|Ms.|win|air|honor|personal|moving|till|admit|problems|murder|strong|he\'d|evil|definitely|feels|information|honest|eye|broke|missed|longer|dollars|tired|Jason|George|evening|human|starting|Ross|red|entire|trip|Brooke|E.|club|Niles|suppose|calm|imagine|Todd|fair|caught|B.|blame|street|sitting|favor|apartment|court|terrible|clean|Tony|learn|Alison|Rick|works|Rose|Frasier|relax|York|million|charity|accident|wake|prove|Danny|smart|message|missing|forgot|small|interested|table|nbsp|become|Craig|mouth|pregnant|middle|Billy|ring|careful|shall|dude|team|ride|figured|wear|shoot|stick|Ray|follow|Bo|angry|instead|buddy|write|stopped|early|Angel|Nick|ran|war|standing|forgive|jail|wearing|Miguel|ladies|kinda|lunch|Cristian|eight|Greenlee|gotten|hoping|Phoebe|thousand|ridge|music|Luke|paper|tough|tape|Emily|state|count|college|boyfriend|proud|agree|birthday|bill|seven|they\'ve|Timmy|history|share|offer|hurry|ow|feet|wondering|simple|decision|building|ones|finish|voice|herself|Chris|would\'ve|list|Kay|mess|deserve|evidence|cute|Jerry|dress|Richard|interesting|Jesus|James|hotel|enjoy|Ryan|Lindsay|quiet|concerned|road|Eve|staying|short|M.|beat|sweetie|mention|clothes|finished|fell|neither|mmm|fix|Victor|respect|spent|prison|attention|holding|calls|near|surprised|bar|Beth|pass|keeping|gift|hadn\'t|putting|dark|self|owe|using|Nora|ice|helping|bitch|normal|aunt|lawyer|apart|certain|plans|Jax|girlfriend|floor|whether|everything\'s|present|earth|private|Jessica|box|Dawson|cover|judge|upstairs|Alexis|Shawn|sake|mommy|possibly|worst)\b)\w+/gi;

var $container = $('.container');
var $backdrop = $('.backdrop');
var $highlights = $('.highlights');
var $textarea = $('textarea');
var $toggle = $('button');

// yeah, browser sniffing sucks, but there are browser-specific quirks to handle that are not a matter of feature detection
var ua = window.navigator.userAgent.toLowerCase();
var isIE = !!ua.match(/msie|trident\/7|edge/);
var isWinPhone = ua.indexOf('windows phone') !== -1;
var isIOS = !isWinPhone && !!ua.match(/ipad|iphone|ipod/);

function applyHighlights(text) {
    text = text
        .replace(/\n$/g, '\n\n')
        .replace(oneKPlus, '<mark>$&</mark>');

    if (isIE) {
        // IE wraps whitespace differently in a div vs textarea, this fixes it
        text = text.replace(/ /g, ' <wbr>');
    }

    return text;
}

function handleInput() {
    var text = $textarea.val();
    var highlightedText = applyHighlights(text);
    $highlights.html(highlightedText);
}

function handleScroll() {
    var scrollTop = $textarea.scrollTop();
    $backdrop.scrollTop(scrollTop);

    var scrollLeft = $textarea.scrollLeft();
    $backdrop.scrollLeft(scrollLeft);
}

function fixIOS() {
    // iOS adds 3px of (unremovable) padding to the left and right of a textarea, so adjust highlights div to match
    $highlights.css({
        'padding-left': '+=3px',
        'padding-right': '+=3px'
    });
}

function bindEvents() {
    $textarea.on({
        'input': handleInput,
        'scroll': handleScroll
    });
}

if (isIOS) {
    fixIOS();
}

bindEvents();
handleInput();
